this_cat_users$n_TB_diff[o]
user = 10c99c4d66cba7ebede3fc2db4a41a6488061b91
user = "10c99c4d66cba7ebede3fc2db4a41a6488061b91"
this_user_days = days[days$user_id == user]
this_user_days = days[days$user_id == user,]
this_user_days
g = ggplot(this_user_days, aes(x = date, y = category, col = type)) + geom_point(shape = "|")
print(g)
unique(days$BC)
trans
ref_date = min(days$date[days$BC == "pill"])
d = this_user_days
ref_date = min(d$date[d$BC == "pill"])
ref_date
d$rel_date = as.numeric(d$date - ref_date)
range(d$rel_date)
g = ggplot(d, aes(x = rel_date, y = category, col = type)) +
geom_point(shape = "|")
g
g = ggplot(d, aes(x = rel_date, y = category, col = type)) +
geom_point(shape = "|")+
facet_grid(user_id ~ .)
g
g = ggplot(d, aes(x = rel_date, y = category, col = type)) +
geom_point(shape = "|")+
facet_grid(user_id ~ .)+
theme(axis.ticks.x = element_blank())
g
g = ggplot(d, aes(x = rel_date, y = category, col = type)) +
geom_point(shape = "|")+
facet_grid(user_id ~ .)+
theme(axis.ticks.x = element_blank(),
panel.grid.major.x = element_blank())
g
g = ggplot(d, aes(x = rel_date, y = category, col = type)) +
geom_vline(xintercept = d$date[d$cycleday == 1])+
geom_point(shape = "|")+
facet_grid(user_id ~ .)+
theme(axis.ticks.x = element_blank(),
panel.grid.major.x = element_blank())
g
g = ggplot(d, aes(x = rel_date, y = category, col = type)) +
geom_vline(xintercept = d$date[d$cycleday == 1])+
geom_point(shape = "|")+
facet_grid(user_id ~ .)+
theme(axis.ticks.x = element_blank(),
panel.grid.major.x = element_blank())
g
g = ggplot(d, aes(x = rel_date, y = category, col = type)) +
geom_vline(xintercept = d$rel_date[d$cycleday == 1])+
geom_point(shape = "|")+
facet_grid(user_id ~ .)+
theme(axis.ticks.x = element_blank(),
panel.grid.major.x = element_blank())
g
g = ggplot(d, aes(x = rel_date, y = category, col = type)) +
geom_vline(xintercept = d$rel_date[d$cycleday == 1])+
geom_point(shape = "|")+
facet_grid(user_id ~ .)+
theme(axis.ticks.x = element_blank(),
panel.grid.major.x = element_blank(),
panel.grid.minor.x = element_blank(),
legend.position="bottom")
g
d = d[!(d$type %in% c("cramps","headache","n_logs","ovulation_pain")),]
g = ggplot(d, aes(x = rel_date, y = category, col = type)) +
geom_vline(xintercept = d$rel_date[d$cycleday == 1])+
geom_point(shape = "|")+
facet_grid(user_id ~ .)+
theme(axis.ticks.x = element_blank(),
panel.grid.major.x = element_blank(),
panel.grid.minor.x = element_blank(),
legend.position="bottom")
g
g = ggplot(d, aes(x = rel_date, y = category, col = type)) +
geom_vline(xintercept = d$rel_date[d$cycleday == 1], col = "gray90")+
geom_point(shape = "|")+
facet_grid(user_id ~ .)+
theme(axis.ticks.x = element_blank(),
panel.grid.major.x = element_blank(),
panel.grid.minor.x = element_blank(),
legend.position="bottom")
g
d$number = 3
d$number[d$type == "heavy"] = 4
d$number[d$type == "medium"] = 3
d$number[d$type == "light"] = 2
d$number[d$type == "spotting"] = 1
g = ggplot(d, aes(x = rel_date, y = category, col = type, size = number)) +
geom_vline(xintercept = d$rel_date[d$cycleday == 1], col = "gray90")+
geom_point(shape = "|")+
facet_grid(user_id ~ .)+
theme(axis.ticks.x = element_blank(),
panel.grid.major.x = element_blank(),
panel.grid.minor.x = element_blank(),
legend.position="bottom")
g
cols_feature = data.frame(type = c("heavy","medium","light","spotting",
"tender_breasts",
"taken"."late","missed","double"),
col = c("tomato4","tomato3","tomato2","tomato1",
"lightblue",
"steelblue","orange","red","black"))
cols_feature = data.frame(type = c("heavy","medium","light","spotting",
"tender_breasts",
"taken","late","missed","double"),
col = c("tomato4","tomato3","tomato2","tomato1",
"lightblue",
"steelblue","orange","red","black"))
cols_feature
head(d$type)
d$type = factor(d$type, levels = cols_feature$type)
d$type = factor(d$type, levels = cols_feature$type)
g = ggplot(d, aes(x = rel_date, y = category, col = type, size = number)) +
geom_vline(xintercept = d$rel_date[d$cycleday == 1], col = "gray90")+
geom_point(shape = "|")+
facet_grid(user_id ~ .)+
scale_color_manual(values = cols_feature$col)+
theme(axis.ticks.x = element_blank(),
panel.grid.major.x = element_blank(),
panel.grid.minor.x = element_blank(),
legend.position="bottom")
g
head(cols_feature$col)
cols_feature = data.frame(type = c("heavy","medium","light","spotting",
"tender_breasts",
"taken","late","missed","double"),
col = c("tomato4","tomato3","tomato2","tomato1",
"lightblue",
"steelblue","orange","red","black"),
stringsAsFactors = FALSE)
g = ggplot(d, aes(x = rel_date, y = category, col = type, size = number)) +
geom_vline(xintercept = d$rel_date[d$cycleday == 1], col = "gray90")+
geom_point(shape = "|")+
facet_grid(user_id ~ .)+
scale_color_manual(values = cols_feature$col)+
theme(axis.ticks.x = element_blank(),
panel.grid.major.x = element_blank(),
panel.grid.minor.x = element_blank(),
legend.position="bottom")
g
pill_transition = pill_transition[1]
if(pill_transition == "on pill"){
ref_date = min(d$date[d$BC == "pill"])
}else if(pill_transition == "off pill"){
ref_date = min(d$date[d$BC == "none / condoms"])
}else{
ref_date = min(d$date)
}
d$rel_date = as.numeric(d$date - ref_date)
if(!is.na(pill_transition)){
d = d[d$rel_date %in% -180:180,]
}
d = d[d$type %in% cols_feature$type,]
d$number = 3
d$number[d$type == "heavy"] = 4
d$number[d$type == "medium"] = 3
d$number[d$type == "light"] = 2
d$number[d$type == "spotting"] = 1
d$type = factor(d$type, levels = cols_feature$type)
g = ggplot(d, aes(x = rel_date, y = category, col = type, size = number)) +
geom_vline(xintercept = d$rel_date[d$cycleday == 1], col = "gray90")+
geom_point(shape = "|")+
facet_grid(user_id ~ .)+
scale_color_manual(values = cols_feature$col)+
theme(axis.ticks.x = element_blank(),
panel.grid.major.x = element_blank(),
panel.grid.minor.x = element_blank(),
legend.position="bottom")
g
!is.na(pill_transition)
pill_transition = "on pill"
pill_transition = pill_transition[1]
if(pill_transition == "on pill"){
ref_date = min(d$date[d$BC == "pill"])
}else if(pill_transition == "off pill"){
ref_date = min(d$date[d$BC == "none / condoms"])
}else{
ref_date = min(d$date)
}
d$rel_date = as.numeric(d$date - ref_date)
if(!is.na(pill_transition)){
d = d[d$rel_date %in% -180:180,]
}
d = d[d$type %in% cols_feature$type,]
d$number = 3
d$number[d$type == "heavy"] = 4
d$number[d$type == "medium"] = 3
d$number[d$type == "light"] = 2
d$number[d$type == "spotting"] = 1
d$type = factor(d$type, levels = cols_feature$type)
g = ggplot(d, aes(x = rel_date, y = category, col = type, size = number)) +
geom_vline(xintercept = d$rel_date[d$cycleday == 1], col = "gray90")+
geom_point(shape = "|")+
facet_grid(user_id ~ .)+
scale_color_manual(values = cols_feature$col)+
theme(axis.ticks.x = element_blank(),
panel.grid.major.x = element_blank(),
panel.grid.minor.x = element_blank(),
legend.position="bottom")
g
cols_feature$col[cols_feature$type %in% unique(d$type),]
cols_feature$col[cols_feature$type %in% unique(d$type)]
pill_transition = pill_transition[1]
if(pill_transition == "on pill"){
ref_date = min(d$date[d$BC == "pill"])
}else if(pill_transition == "off pill"){
ref_date = min(d$date[d$BC == "none / condoms"])
}else{
ref_date = min(d$date)
}
d$rel_date = as.numeric(d$date - ref_date)
if(!is.na(pill_transition)){
d = d[d$rel_date %in% -180:180,]
}
d = d[d$type %in% cols_feature$type,]
d$number = 3
d$number[d$type == "heavy"] = 4
d$number[d$type == "medium"] = 3
d$number[d$type == "light"] = 2
d$number[d$type == "spotting"] = 1
d$type = factor(d$type, levels = cols_feature$type)
colors = cols_feature$col[cols_feature$type %in% unique(d$type)]
g = ggplot(d, aes(x = rel_date, y = category, col = type, size = number)) +
geom_vline(xintercept = d$rel_date[d$cycleday == 1], col = "gray90")+
geom_point(shape = "|")+
facet_grid(user_id ~ .)+
scale_color_manual(values = cols_feature$col)+
theme(axis.ticks.x = element_blank(),
panel.grid.major.x = element_blank(),
panel.grid.minor.x = element_blank(),
legend.position="bottom")+
guides(size = FALSE)
g
g = ggplot(d, aes(x = rel_date, y = category, col = type, size = number)) +
geom_vline(xintercept = d$rel_date[d$cycleday == 1], col = "gray90")+
geom_point(shape = "|")+
facet_grid(user_id ~ .)+
scale_color_manual(values = colors)+
theme(axis.ticks.x = element_blank(),
panel.grid.major.x = element_blank(),
panel.grid.minor.x = element_blank(),
legend.position="bottom")+
guides(size = FALSE)
g
cols_feature = data.frame(type = c("heavy","medium","light","spotting",
"tender_breasts",
"taken","late","missed","double"),
col = c("tomato4","tomato3","tomato2","tomato1",
"lightblue",
"steelblue1","orange","red","black"),
stringsAsFactors = FALSE)
colors = cols_feature$col[cols_feature$type %in% unique(d$type)]
g = ggplot(d, aes(x = rel_date, y = category, col = type, size = number)) +
geom_vline(xintercept = d$rel_date[d$cycleday == 1], col = "gray90")+
geom_point(shape = "|")+
facet_grid(user_id ~ .)+
scale_color_manual(values = colors)+
theme(axis.ticks.x = element_blank(),
panel.grid.major.x = element_blank(),
panel.grid.minor.x = element_blank(),
legend.position="bottom")+
guides(size = FALSE)
g
cols_feature = data.frame(type = c("heavy","medium","light","spotting",
"tender_breasts",
"taken","late","missed","double"),
col = c("tomato4","tomato3","tomato2","tomato1",
"lightblue",
"steelblue2","orange","red","black"),
stringsAsFactors = FALSE)
colors = cols_feature$col[cols_feature$type %in% unique(d$type)]
g = ggplot(d, aes(x = rel_date, y = category, col = type, size = number)) +
geom_vline(xintercept = d$rel_date[d$cycleday == 1], col = "gray90")+
geom_point(shape = "|")+
facet_grid(user_id ~ .)+
scale_color_manual(values = colors)+
theme(axis.ticks.x = element_blank(),
panel.grid.major.x = element_blank(),
panel.grid.minor.x = element_blank(),
legend.position="bottom")+
guides(size = FALSE)
g
cols_feature = data.frame(type = c("heavy","medium","light","spotting",
"tender_breasts",
"taken","late","missed","double"),
col = c("tomato4","tomato3","tomato2","tomato1",
"lightblue",
"steelblue3","orange","red","black"),
stringsAsFactors = FALSE)
colors = cols_feature$col[cols_feature$type %in% unique(d$type)]
g = ggplot(d, aes(x = rel_date, y = category, col = type, size = number)) +
geom_vline(xintercept = d$rel_date[d$cycleday == 1], col = "gray90")+
geom_point(shape = "|")+
facet_grid(user_id ~ .)+
scale_color_manual(values = colors)+
theme(axis.ticks.x = element_blank(),
panel.grid.major.x = element_blank(),
panel.grid.minor.x = element_blank(),
legend.position="bottom")+
guides(size = FALSE)
g
ggplot_user_history = function(d, pill_transition = c(NA,"on pill","off pill")){
pill_transition = pill_transition[1]
if(pill_transition == "on pill"){
ref_date = min(d$date[d$BC == "pill"])
}else if(pill_transition == "off pill"){
ref_date = min(d$date[d$BC == "none / condoms"])
}else{
ref_date = min(d$date)
}
d$rel_date = as.numeric(d$date - ref_date)
if(!is.na(pill_transition)){
d = d[d$rel_date %in% -180:180,]
}
d = d[d$type %in% cols_feature$type,]
d$number = 3
d$number[d$type == "heavy"] = 4
d$number[d$type == "medium"] = 3
d$number[d$type == "light"] = 2
d$number[d$type == "spotting"] = 1
d$type = factor(d$type, levels = cols_feature$type)
colors = cols_feature$col[cols_feature$type %in% unique(d$type)]
g = ggplot(d, aes(x = rel_date, y = category, col = type, size = number)) +
geom_vline(xintercept = d$rel_date[d$cycleday == 1], col = "gray90")+
geom_point(shape = "|")+
facet_grid(user_id ~ .)+
scale_color_manual(values = colors)+
theme(axis.ticks.x = element_blank(),
panel.grid.major.x = element_blank(),
panel.grid.minor.x = element_blank(),
legend.position="bottom")+
guides(size = FALSE)
g
return(g)
}
pill_trans_users = users[users$user_id %in% unique(days$user_id),]
for(trans in c("on pill","off pill")){
for(change in c("increase","decrease")){
if(trans == "on pill"){
pill_trans_users$n_TB_diff = pill_trans_users$n_TB_diff_on_pill
pill_trans_users$TB_diff = pill_trans_users$TB_diff_on_pill
}else{
pill_trans_users$n_TB_diff = pill_trans_users$n_TB_diff_off_pill
pill_trans_users$TB_diff = pill_trans_users$TB_diff_off_pill
}
j = which((pill_trans_users$BC == trans) & (pill_trans_users$TB_diff == change))
this_cat_users = pill_trans_users[j,]
o = order(abs(this_cat_users$n_TB_diff), decreasing = TRUE)
user_ids = this_cat_users$user_id[o][1:10]
for(user in user_ids){
this_user_days = days[days$user_id == user,]
g = ggplot_user_history(this_user_days, pill_transition = trans)
print(g)
}
}
}
for(trans in c("on pill","off pill")){
for(change in c("increase","decrease")){
if(trans == "on pill"){
pill_trans_users$n_TB_diff = pill_trans_users$n_TB_diff_on_pill
pill_trans_users$TB_diff = pill_trans_users$TB_diff_on_pill
}else{
pill_trans_users$n_TB_diff = pill_trans_users$n_TB_diff_off_pill
pill_trans_users$TB_diff = pill_trans_users$TB_diff_off_pill
}
j = which((pill_trans_users$BC == trans) & (pill_trans_users$TB_diff == change))
this_cat_users = pill_trans_users[j,]
o = order(abs(this_cat_users$n_TB_diff), decreasing = TRUE)
user_ids = this_cat_users$user_id[o][1:10]
for(user in user_ids){
this_user_days = days[days$user_id == user,]
g = ggplot_user_history(this_user_days, pill_transition = trans)
print(g)
}
}
}
source('~/Google Drive/Ladies & Gentlemen/Papers/Tender_Breasts/TB-Public-Repo/Code/Scripts/00_functions_viz.R')
pill_trans_users = users[users$user_id %in% unique(days$user_id),]
for(trans in c("on pill","off pill")){
for(change in c("increase","decrease")){
if(trans == "on pill"){
pill_trans_users$n_TB_diff = pill_trans_users$n_TB_diff_on_pill
pill_trans_users$TB_diff = pill_trans_users$TB_diff_on_pill
}else{
pill_trans_users$n_TB_diff = pill_trans_users$n_TB_diff_off_pill
pill_trans_users$TB_diff = pill_trans_users$TB_diff_off_pill
}
j = which((pill_trans_users$BC == trans) & (pill_trans_users$TB_diff == change))
this_cat_users = pill_trans_users[j,]
o = order(abs(this_cat_users$n_TB_diff), decreasing = TRUE)
user_ids = this_cat_users$user_id[o][1:10]
for(user in user_ids){
this_user_days = days[days$user_id == user,]
g = ggplot_user_history(this_user_days, pill_transition = trans)
print(g)
}
}
}
pill_trans_users = users[users$user_id %in% unique(days$user_id),]
for(trans in c("on pill","off pill")){
cat(trans, "\n")
for(change in c("increase","decrease")){
cat("\t",change, "\n")
if(trans == "on pill"){
pill_trans_users$n_TB_diff = pill_trans_users$n_TB_diff_on_pill
pill_trans_users$TB_diff = pill_trans_users$TB_diff_on_pill
}else{
pill_trans_users$n_TB_diff = pill_trans_users$n_TB_diff_off_pill
pill_trans_users$TB_diff = pill_trans_users$TB_diff_off_pill
}
j = which((pill_trans_users$BC == trans) & (pill_trans_users$TB_diff == change))
this_cat_users = pill_trans_users[j,]
o = order(abs(this_cat_users$n_TB_diff), decreasing = TRUE)
user_ids = this_cat_users$user_id[o][1:5]
for(user in user_ids){
cat("\t\t",user,"\n")
this_user_days = days[days$user_id == user,]
g = ggplot_user_history(this_user_days, pill_transition = trans)
print(g)
}
}
}
source("Scripts/00_setup.R")
source('~/Google Drive/Ladies & Gentlemen/Papers/Tender_Breasts/TB-Public-Repo/Code/Scripts/00_variables.R')
load(file = paste0(IO$output_data,"users.Rdata"), verbose = TRUE)
load(file = paste0(IO$tmp_data, "days_pill_trans.Rdata"), verbose = TRUE)
source('~/Google Drive/Ladies & Gentlemen/Papers/Tender_Breasts/TB-Public-Repo/Code/Scripts/00_functions_viz.R')
source('~/Google Drive/Ladies & Gentlemen/Papers/Tender_Breasts/TB-Public-Repo/Code/Scripts/00_functions_viz.R')
source('~/Google Drive/Ladies & Gentlemen/Papers/Tender_Breasts/TB-Public-Repo/Code/Scripts/00_functions_viz.R')
source('~/Google Drive/Ladies & Gentlemen/Papers/Tender_Breasts/TB-Public-Repo/Code/Scripts/00_functions_viz.R')
user_ids = c("1e373dfaa7f3f5ddba01073bccc2c1fd566dfded", # on-pill increase
"77ee91ac45472d126f2582b6fc5899768ee501be", # on-pill decrease
"1e54913ee421d364f831da6ace198d2e8deff7d9", # off-pill increase
"8a03c607cf058ea0a649cd63c2d09d3d2198c7d6" ) # off-pill decrease
for(user in user_ids){
cat("\t\t",user,"\n")
this_user_days = days[days$user_id == user,]
trans = users$BC[users$user_id == user]
g = ggplot_user_history(this_user_days, pill_transition = trans)
print(g)
}
source('~/Google Drive/Ladies & Gentlemen/Papers/Tender_Breasts/TB-Public-Repo/Code/Scripts/00_functions_viz.R')
source('~/Google Drive/Ladies & Gentlemen/Papers/Tender_Breasts/TB-Public-Repo/Code/Scripts/00_functions_viz.R')
user_ids = c("1e373dfaa7f3f5ddba01073bccc2c1fd566dfded", # on-pill increase
"77ee91ac45472d126f2582b6fc5899768ee501be", # on-pill decrease
"1e54913ee421d364f831da6ace198d2e8deff7d9", # off-pill increase
"8a03c607cf058ea0a649cd63c2d09d3d2198c7d6" ) # off-pill decrease
for(user in user_ids){
cat("\t\t",user,"\n")
this_user_days = days[days$user_id == user,]
trans = users$BC[users$user_id == user]
g = ggplot_user_history(this_user_days, pill_transition = trans)
print(g)
}
source('~/Google Drive/Ladies & Gentlemen/Papers/Tender_Breasts/TB-Public-Repo/Code/Scripts/00_functions_viz.R')
user_ids = c("1e373dfaa7f3f5ddba01073bccc2c1fd566dfded", # on-pill increase
"77ee91ac45472d126f2582b6fc5899768ee501be", # on-pill decrease
"1e54913ee421d364f831da6ace198d2e8deff7d9", # off-pill increase
"8a03c607cf058ea0a649cd63c2d09d3d2198c7d6" ) # off-pill decrease
for(user in user_ids){
cat("\t\t",user,"\n")
this_user_days = days[days$user_id == user,]
trans = users$BC[users$user_id == user]
g = ggplot_user_history(this_user_days, pill_transition = trans)
print(g)
}
selected_users_days = days[days$user_id %in% user_ids, ]
selected_users_days$user_id = factor(selected_users_days$user_id, levels = unique(selected_users_days$user_id))
selected_users_days = days[days$user_id %in% user_ids, ]
selected_users_days$user_id = factor(selected_users_days$user_id, levels = unique(selected_users_days$user_id))
selected_users_days$user_id = paste0("user_", as.numeric(selected_users_days$user_id ))
unique(selected_users_days$user_id)
days
save(selected_users_days, file = paste0(IO$tmp_data,"days_selected_users_for_pill_transition_examples.Rdata"))
user_ids = c("1e373dfaa7f3f5ddba01073bccc2c1fd566dfded", # on-pill increase
"77ee91ac45472d126f2582b6fc5899768ee501be", # on-pill decrease
"1e54913ee421d364f831da6ace198d2e8deff7d9", # off-pill increase
"8a03c607cf058ea0a649cd63c2d09d3d2198c7d6" ) # off-pill decrease
for(user in user_ids){
cat("\t\t",user,"\n")
this_user_days = days[days$user_id == user,]
trans = users$BC[users$user_id == user]
g = ggplot_user_history(this_user_days, pill_transition = trans)
print(g)
}
selected_users_days = days[days$user_id %in% user_ids, ]
selected_users_days$user_id = factor(selected_users_days$user_id, levels = unique(selected_users_days$user_id))
selected_users_days$user_id = paste0("user_", as.numeric(selected_users_days$user_id ))
selected_users_days$user_BC = users$BC[match(selected_users_days$user_id, users$user_id)]
save(selected_users_days, file = paste0(IO$tmp_data,"days_selected_users_for_pill_transition_examples.Rdata"))
source('~/Google Drive/Ladies & Gentlemen/Papers/Tender_Breasts/TB-Public-Repo/Code/Scripts/00_functions_viz.R')
user = "1e373dfaa7f3f5ddba01073bccc2c1fd566dfded"
cat("\t\t",user,"\n")
this_user_days = days[days$user_id == user,]
trans = users$BC[users$user_id == user]
trans
g = ggplot_user_history(this_user_days, pill_transition = trans)
print(g)
user = "77ee91ac45472d126f2582b6fc5899768ee501be"
this_user_days = days[days$user_id == user,]
trans = users$BC[users$user_id == user]
trans
user = "1e54913ee421d364f831da6ace198d2e8deff7d9"
this_user_days = days[days$user_id == user,]
trans = users$BC[users$user_id == user]
trans
user = 8a03c607cf058ea0a649cd63c2d09d3d2198c7d6
user= "8a03c607cf058ea0a649cd63c2d09d3d2198c7d6"
this_user_days = days[days$user_id == user,]
trans = users$BC[users$user_id == user]
trans
