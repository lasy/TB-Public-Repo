ggplot(fraction_TB, aes(x = cycle_nb_m, y = median_n_TB, col = most_preval_clust, fill = most_preval_clust)) +
geom_line() +
geom_line(aes(y = avg_n_TB), linetype = 3) +
geom_ribbon(aes(ymin = q_05_n_TB , ymax = q_95_n_TB), alpha = 0.2, col = NA)+
geom_ribbon(aes(ymin = q_25_n_TB , ymax = q_75_n_TB), alpha = 0.2, col = NA)+
geom_text(data = min_n_cycles, aes(label = paste0("min # = ",min_n_cycles)), x = 5, y = 0.95*max(fraction_TB$q_95_n_TB), size = 3, vjust = 0, hjust = 0)+
facet_grid(birth_control  ~ most_preval_clust)+
scale_color_manual(values = cols$clusters_6) + scale_fill_manual(values = cols$clusters_6)+
guides(col = FALSE, fill = FALSE) +
theme(strip.text.x = element_blank())+
xlab("Cycle number") + ylab("# of reported TB")
g = ggplot(fraction_TB, aes(x = cycle_nb_m, y = median_n_TB, col = most_preval_clust, fill = most_preval_clust)) +
geom_line() +
geom_line(aes(y = avg_n_TB), linetype = 3) +
geom_ribbon(aes(ymin = q_05_n_TB , ymax = q_95_n_TB), alpha = 0.2, col = NA)+
geom_ribbon(aes(ymin = q_25_n_TB , ymax = q_75_n_TB), alpha = 0.2, col = NA)+
geom_text(data = min_n_cycles, aes(label = paste0("min # = ",min_n_cycles)), x = 5, y = 0.95*max(fraction_TB$q_95_n_TB), size = 3, vjust = 0, hjust = 0)+
facet_grid(birth_control  ~ most_preval_clust)+
scale_color_manual(values = cols$clusters_6) + scale_fill_manual(values = cols$clusters_6)+
guides(col = FALSE, fill = FALSE) +
theme(strip.text.x = element_blank())+
xlab("Cycle number") + ylab("# of reported TB")
g
ggsave(filename = paste0(IO$panels, "3_evolution_of_symptom_tracking_in_time.pdf"), plot = g, width = viz$full_width/3, height = viz$full_width/4.5, scale = viz$scale)
ggsave(filename = paste0(IO$panels, "3_evolution_of_symptom_tracking_in_time.pdf"), plot = g, width = viz$full_width/2, height = viz$full_width/4.5, scale = viz$scale)
g = ggplot(fraction_TB, aes(x = cycle_nb_m, y = median_n_TB, col = most_preval_clust, fill = most_preval_clust)) +
geom_line() +
geom_line(aes(y = avg_n_TB), linetype = 3) +
geom_ribbon(aes(ymin = q_05_n_TB , ymax = q_95_n_TB), alpha = 0.2, col = NA)+
geom_ribbon(aes(ymin = q_25_n_TB , ymax = q_75_n_TB), alpha = 0.2, col = NA)+
geom_text(data = min_n_cycles, aes(label = paste0("min # = ",min_n_cycles)), x = 5, y = 0.95*max(fraction_TB$q_95_n_TB), size = 3, vjust = 0, hjust = 0)+
facet_grid( most_preval_clust ~ birth_control )+
scale_color_manual(values = cols$clusters_6) + scale_fill_manual(values = cols$clusters_6)+
guides(col = FALSE, fill = FALSE) +
theme(strip.text.y = element_blank())+
xlab("Cycle number") + ylab("# of reported TB")
g
ggsave(filename = paste0(IO$panels, "3_evolution_of_symptom_tracking_in_time.pdf"), plot = g, width = viz$full_width/2, height = viz$full_width/4.5, scale = viz$scale)
ggsave(filename = paste0(IO$panels, "3_evolution_of_symptom_tracking_in_time.pdf"), plot = g, width = viz$full_width/4, height = viz$full_width/4, scale = viz$scale)
g = ggplot(fraction_TB, aes(x = cycle_nb_m, y = median_n_TB, col = most_preval_clust, fill = most_preval_clust)) +
geom_line() +
geom_line(aes(y = avg_n_TB), linetype = 3) +
geom_ribbon(aes(ymin = q_05_n_TB , ymax = q_95_n_TB), alpha = 0.2, col = NA)+
geom_ribbon(aes(ymin = q_25_n_TB , ymax = q_75_n_TB), alpha = 0.2, col = NA)+
geom_text(data = min_n_cycles, aes(label = paste0("min # = ",min_n_cycles)), x = 5, y = 0.95*max(fraction_TB$q_95_n_TB), size = 3, vjust = 0, hjust = 0)+
facet_grid(birth_control  ~ most_preval_clust)+
scale_color_manual(values = cols$clusters_6) + scale_fill_manual(values = cols$clusters_6)+
guides(col = FALSE, fill = FALSE) +
theme(strip.text.x = element_blank())+
xlab("Cycle number") + ylab("# of reported TB")
g
ggsave(filename = paste0(IO$panels, "3_evolution_of_symptom_tracking_in_time.pdf"), plot = g, width = viz$full_width/2, height = viz$full_width/4, scale = viz$scale)
ggsave(filename = paste0(IO$panels, "3_evolution_of_symptom_tracking_in_time.pdf"), plot = g, width = viz$full_width/2.5, height = viz$full_width/4, scale = viz$scale)
g = ggplot(fraction_TB, aes(x = cycle_nb_m, y = median_n_TB, col = most_preval_clust, fill = most_preval_clust)) +
geom_line() +
geom_line(aes(y = avg_n_TB), linetype = 3) +
geom_ribbon(aes(ymin = q_05_n_TB , ymax = q_95_n_TB), alpha = 0.2, col = NA)+
geom_ribbon(aes(ymin = q_25_n_TB , ymax = q_75_n_TB), alpha = 0.2, col = NA)+
geom_text(data = min_n_cycles, aes(label = paste0("(",min_n_cycles,")")), x = 5, y = 0.95*max(fraction_TB$q_95_n_TB), size = 3, vjust = 0, hjust = 0)+
facet_grid(birth_control  ~ most_preval_clust)+
scale_color_manual(values = cols$clusters_6) + scale_fill_manual(values = cols$clusters_6)+
guides(col = FALSE, fill = FALSE) +
theme(strip.text.x = element_blank())+
xlab("Cycle number") + ylab("# of reported TB")
g
ggsave(filename = paste0(IO$panels, "3_evolution_of_symptom_tracking_in_time.pdf"), plot = g, width = viz$full_width/2.5, height = viz$full_width/4, scale = viz$scale)
g = ggplot(fraction_TB, aes(x = cycle_nb_m, y = median_n_TB, col = most_preval_clust, fill = most_preval_clust)) +
geom_line() +
geom_line(aes(y = avg_n_TB), linetype = 2) +
geom_ribbon(aes(ymin = q_05_n_TB , ymax = q_95_n_TB), alpha = 0.2, col = NA)+
geom_ribbon(aes(ymin = q_25_n_TB , ymax = q_75_n_TB), alpha = 0.2, col = NA)+
geom_text(data = min_n_cycles, aes(label = paste0("(",min_n_cycles,")")), x = 5, y = 0.95*max(fraction_TB$q_95_n_TB), size = 3, vjust = 0, hjust = 0)+
facet_grid(birth_control  ~ most_preval_clust)+
scale_color_manual(values = cols$clusters_6) + scale_fill_manual(values = cols$clusters_6)+
guides(col = FALSE, fill = FALSE) +
theme(strip.text.x = element_blank())+
xlab("Cycle number") + ylab("# of reported TB")
g
ggsave(filename = paste0(IO$panels, "3_evolution_of_symptom_tracking_in_time.pdf"), plot = g, width = viz$full_width/2.5, height = viz$full_width/4, scale = viz$scale)
g = ggplot(fraction_TB, aes(x = cycle_nb_m, y = median_n_TB, col = most_preval_clust, fill = most_preval_clust)) +
geom_line() +
geom_line(aes(y = avg_n_TB), linetype = 2, size = 0.75) +
geom_ribbon(aes(ymin = q_05_n_TB , ymax = q_95_n_TB), alpha = 0.2, col = NA)+
geom_ribbon(aes(ymin = q_25_n_TB , ymax = q_75_n_TB), alpha = 0.2, col = NA)+
geom_text(data = min_n_cycles, aes(label = paste0("(",min_n_cycles,")")), x = 5, y = 0.95*max(fraction_TB$q_95_n_TB), size = 3, vjust = 0, hjust = 0)+
facet_grid(birth_control  ~ most_preval_clust)+
scale_color_manual(values = cols$clusters_6) + scale_fill_manual(values = cols$clusters_6)+
guides(col = FALSE, fill = FALSE) +
theme(strip.text.x = element_blank())+
xlab("Cycle number") + ylab("# of reported TB")
g
ggsave(filename = paste0(IO$panels, "3_evolution_of_symptom_tracking_in_time.pdf"), plot = g, width = viz$full_width/2.5, height = viz$full_width/4, scale = viz$scale)
g = ggplot(fraction_TB, aes(x = cycle_nb_m, y = median_n_TB, col = most_preval_clust, fill = most_preval_clust)) +
geom_line(size = 1) +
geom_line(aes(y = avg_n_TB), linetype = 2, size = 0.5) +
geom_ribbon(aes(ymin = q_05_n_TB , ymax = q_95_n_TB), alpha = 0.2, col = NA)+
geom_ribbon(aes(ymin = q_25_n_TB , ymax = q_75_n_TB), alpha = 0.2, col = NA)+
geom_text(data = min_n_cycles, aes(label = paste0("(",min_n_cycles,")")), x = 5, y = 0.95*max(fraction_TB$q_95_n_TB), size = 3, vjust = 0, hjust = 0)+
facet_grid(birth_control  ~ most_preval_clust)+
scale_color_manual(values = cols$clusters_6) + scale_fill_manual(values = cols$clusters_6)+
guides(col = FALSE, fill = FALSE) +
theme(strip.text.x = element_blank())+
xlab("Cycle number") + ylab("# of reported TB")
g
ggsave(filename = paste0(IO$panels, "3_evolution_of_symptom_tracking_in_time.pdf"), plot = g, width = viz$full_width/2.5, height = viz$full_width/4, scale = viz$scale)
g = ggplot(fraction_TB, aes(x = cycle_nb_m, y = median_n_TB, col = most_preval_clust, fill = most_preval_clust)) +
geom_line(size = 0.75) +
geom_line(aes(y = avg_n_TB), linetype = 2, size = 0.25) +
geom_ribbon(aes(ymin = q_05_n_TB , ymax = q_95_n_TB), alpha = 0.2, col = NA)+
geom_ribbon(aes(ymin = q_25_n_TB , ymax = q_75_n_TB), alpha = 0.2, col = NA)+
geom_text(data = min_n_cycles, aes(label = paste0("(",min_n_cycles,")")), x = 5, y = 0.95*max(fraction_TB$q_95_n_TB), size = 3, vjust = 0, hjust = 0)+
facet_grid(birth_control  ~ most_preval_clust)+
scale_color_manual(values = cols$clusters_6) + scale_fill_manual(values = cols$clusters_6)+
guides(col = FALSE, fill = FALSE) +
theme(strip.text.x = element_blank())+
xlab("Cycle number") + ylab("# of reported TB")
g
ggsave(filename = paste0(IO$panels, "3_evolution_of_symptom_tracking_in_time.pdf"), plot = g, width = viz$full_width/2.5, height = viz$full_width/4, scale = viz$scale)
g = ggplot(fraction_TB, aes(x = cycle_nb_m, y = median_n_TB, col = most_preval_clust, fill = most_preval_clust)) +
geom_line(size = 0.75) +
geom_line(aes(y = avg_n_TB), linetype = 2, size = 0.25) +
geom_ribbon(aes(ymin = q_05_n_TB , ymax = q_95_n_TB), alpha = 0.2, col = NA)+
geom_ribbon(aes(ymin = q_25_n_TB , ymax = q_75_n_TB), alpha = 0.3, col = NA)+
geom_text(data = min_n_cycles, aes(label = paste0("(",min_n_cycles,")")), x = 5, y = 0.95*max(fraction_TB$q_95_n_TB), size = 3, vjust = 0, hjust = 0)+
facet_grid(birth_control  ~ most_preval_clust)+
scale_color_manual(values = cols$clusters_6) + scale_fill_manual(values = cols$clusters_6)+
guides(col = FALSE, fill = FALSE) +
theme(strip.text.x = element_blank())+
xlab("Cycle number") + ylab("# of reported TB")
g
ggsave(filename = paste0(IO$panels, "3_evolution_of_symptom_tracking_in_time.pdf"), plot = g, width = viz$full_width/2.5, height = viz$full_width/4, scale = viz$scale)
head(users)
load(paste0(IO$tmp_Rdata, "users.Rdata"), verbose = TRUE)
load(paste0(IO$tmp_Rdata, "users.Rdata"), verbose = TRUE)
colnames(users)
load(paste0(IO$input_Rdata, "users.Rdata"), verbose = TRUE)
IO$input_Rdata
load(paste0(IO$input_data, "users.Rdata"), verbose = TRUE)
colnames(users)
agg = aggregate( user_id ~ n_tender_breasts, users, uniqueN)
head(agg)
agg$n_users = agg$user_id
agg$perc_users = agg$n_users/sum(agg$n_users)
agg$n_users = agg$user_id
agg$perc_users = agg$n_users/sum(agg$n_users)*100
ggplot(agg, x = n_tender_breasts, y = perc_users) +
geom_bar(stat = "identity")
ggplot(agg, x = n_tender_breasts, y = perc_users) +
geom_bar(stats = "identity")
ggplot(agg, aes(x = n_tender_breasts, y = perc_users)) +
geom_bar(stat = "identity")
users$n_tender_breasts_ul = pmin(users$n_tender_breasts, 100)
agg = aggregate( user_id ~ n_tender_breasts_ul, users, uniqueN)
agg$n_users = agg$user_id
agg$perc_users = agg$n_users/sum(agg$n_users)*100
ggplot(agg, aes(x = n_tender_breasts_ul, y = perc_users)) +
geom_bar(stat = "identity")
users$n_tender_breasts_ul = pmin(users$n_tender_breasts, 50)
agg = aggregate( user_id ~ n_tender_breasts_ul, users, uniqueN)
agg$n_users = agg$user_id
agg$perc_users = agg$n_users/sum(agg$n_users)*100
ggplot(agg, aes(x = n_tender_breasts_ul, y = perc_users)) +
geom_bar(stat = "identity")
colnames(users)
users$frac_tender_breasts = round(users$n_tender_breasts/users$n_cycle, digits = 2)
users$frac_tender_breasts = round(users$n_tender_breasts/users$n_cycle, digits = 2)
agg = aggregate( user_id ~ frac_tender_breasts, users, uniqueN)
agg$n_users = agg$user_id
agg$perc_users = agg$n_users/sum(agg$n_users)*100
ggplot(agg, aes(x = frac_tender_breasts, y = perc_users)) +
geom_bar(stat = "identity")
users$frac_tender_breasts = round(users$n_tender_breasts/users$n_cycle, digits = 1)
agg = aggregate( user_id ~ frac_tender_breasts, users, uniqueN)
agg$n_users = agg$user_id
agg$perc_users = agg$n_users/sum(agg$n_users)*100
ggplot(agg, aes(x = frac_tender_breasts, y = perc_users)) +
geom_bar(stat = "identity")
users$frac_tender_breasts = pmin(round(users$n_tender_breasts/users$n_cycle, digits = 1),5)
agg = aggregate( user_id ~ frac_tender_breasts, users, uniqueN)
agg$n_users = agg$user_id
agg$perc_users = agg$n_users/sum(agg$n_users)*100
ggplot(agg, aes(x = frac_tender_breasts, y = perc_users)) +
geom_bar(stat = "identity")
users$frac_tender_breasts = pmin(round(users$n_tender_breasts/users$n_cycle, digits = 1),3)
agg = aggregate( user_id ~ frac_tender_breasts, users, uniqueN)
agg$n_users = agg$user_id
agg$perc_users = agg$n_users/sum(agg$n_users)*100
ggplot(agg, aes(x = frac_tender_breasts, y = perc_users)) +
geom_bar(stat = "identity")
users$frac_tender_breasts = pmin(round(users$n_tender_breasts/users$n_cycle, digits = 1),2)
agg = aggregate( user_id ~ frac_tender_breasts, users, uniqueN)
agg$n_users = agg$user_id
agg$perc_users = agg$n_users/sum(agg$n_users)*100
ggplot(agg, aes(x = frac_tender_breasts, y = perc_users)) +
geom_bar(stat = "identity")
users$frac_tender_breasts = pmin(round(users$n_tender_breasts/users$n_cycle, digits = 1),3)
agg = aggregate( user_id ~ frac_tender_breasts, users, uniqueN)
agg$n_users = agg$user_id
agg$perc_users = agg$n_users/sum(agg$n_users)*100
ggplot(agg, aes(x = frac_tender_breasts, y = perc_users)) +
geom_bar(stat = "identity")
load(paste0(IO$input_data, "cycles.Rdata"), verbose = TRUE)
head(cycles)
colnames(cycles)
agg =  aggregate( cycle_id ~ tender_breasts_ul, cycles, uniqueN)
cycles$tender_breasts_ul = pmin(cycles$tender_breasts, 28)
agg =  aggregate( cycle_id ~ tender_breasts_ul, cycles, uniqueN)
agg$n_cycles = agg$cycle_id
agg$perc_cycles = agg$n_cycles/sum(agg$n_cycles)*100
ggplot(agg, aes(x = tender_breasts_ul, y = perc_cycles)) +
geom_bar(stat = "identity")
cycles$tender_breasts_ul = pmin(cycles$tender_breasts, 20)
agg =  aggregate( cycle_id ~ tender_breasts_ul, cycles, uniqueN)
agg$n_cycles = agg$cycle_id
agg$perc_cycles = agg$n_cycles/sum(agg$n_cycles)*100
ggplot(agg, aes(x = tender_breasts_ul, y = perc_cycles)) +
geom_bar(stat = "identity")
agg =  aggregate( cycle_id ~ tender_breasts_ul + birth_control, cycles, uniqueN)
agg$n_cycles = agg$cycle_id
agg$perc_cycles = agg$n_cycles/sum(agg$n_cycles)*100
ggplot(agg, aes(x = tender_breasts_ul, y = perc_cycles, fill = birth_control)) +
geom_bar(stat = "identity") + scale_fill_manual(values = cols$BC)
ggplot(agg, aes(x = tender_breasts_ul, y = perc_cycles, fill = birth_control)) +
geom_bar(stat = "identity") + scale_fill_manual(values = cols$BC) + facet_grid(birth_control)
ggplot(agg, aes(x = tender_breasts_ul, y = perc_cycles, fill = birth_control)) +
geom_bar(stat = "identity") + scale_fill_manual(values = cols$BC) + facet_grid(birth_control~.)
cycles$tender_breasts_ul = pmin(cycles$tender_breasts, 10)
agg =  aggregate( cycle_id ~ tender_breasts_ul + birth_control, cycles, uniqueN)
agg$n_cycles = agg$cycle_id
agg$perc_cycles = agg$n_cycles/sum(agg$n_cycles)*100
ggplot(agg, aes(x = tender_breasts_ul, y = perc_cycles, fill = birth_control)) +
geom_bar(stat = "identity") + scale_fill_manual(values = cols$BC) + facet_grid(birth_control~.)
agg_2 = aggregate(n_cycles ~ birth_control,agg, sum)
agg =  aggregate( cycle_id ~ tender_breasts_ul + birth_control, cycles, uniqueN)
agg$n_cycles = agg$cycle_id
agg_2 = aggregate(n_cycles ~ birth_control,agg, sum)
colnames(agg_2) = c("tot_n_cycles","birth_control")
agg = merge(agg, agg_2, all = TRUE)
agg$perc_cycles = agg$n_cycles/agg$tot_n_cycles*100
ggplot(agg, aes(x = tender_breasts_ul, y = perc_cycles, fill = birth_control)) +
geom_bar(stat = "identity") + scale_fill_manual(values = cols$BC) + facet_grid(birth_control~.)
agg
agg =  aggregate( cycle_id ~ tender_breasts_ul + birth_control, cycles, uniqueN)
agg$n_cycles = agg$cycle_id
agg_2 = aggregate(n_cycles ~ birth_control,agg, sum)
colnames(agg_2) = c("tot_n_cycles","birth_control")
agg = merge(agg, agg_2,by = "birth_control", all = TRUE)
agg$perc_cycles = agg$n_cycles/agg$tot_n_cycles*100
agg
colnames(cycles)
agg =  aggregate( cycle_id ~ tender_breasts_ul + BC, cycles, uniqueN)
agg$n_cycles = agg$cycle_id
agg_2 = aggregate(n_cycles ~ BC,agg, sum)
colnames(agg_2) = c("tot_n_cycles","BC")
agg = merge(agg, agg_2,by = "BC", all = TRUE)
agg$perc_cycles = agg$n_cycles/agg$tot_n_cycles*100
agg
agg_2
agg =  aggregate( cycle_id ~ tender_breasts_ul + BC, cycles, uniqueN)
agg$n_cycles = agg$cycle_id
agg
agg$n_cycles = agg$cycle_id
agg_2 = aggregate(n_cycles ~ BC,agg, sum)
agg_2
agg =  aggregate( cycle_id ~ tender_breasts_ul + BC, cycles, uniqueN)
agg$n_cycles = agg$cycle_id
agg_2 = aggregate(n_cycles ~ BC,agg, sum)
colnames(agg_2)[which(colnames(agg_2) == "n_cycles")] = "tot_n_cycles"
agg = merge(agg, agg_2,by = "BC", all = TRUE)
agg$perc_cycles = agg$n_cycles/agg$tot_n_cycles*100
ggplot(agg, aes(x = tender_breasts_ul, y = perc_cycles, fill = BC)) +
geom_bar(stat = "identity") + scale_fill_manual(values = cols$BC) + facet_grid(BC~.)
agg =  aggregate( cycle_id ~ tender_breasts_ul + BC, cycles, uniqueN)
agg$n_cycles = agg$cycle_id
agg_2 = aggregate(n_cycles ~ BC,agg, sum)
colnames(agg_2)[which(colnames(agg_2) == "n_cycles")] = "tot_n_cycles"
agg = merge(agg, agg_2,by = "BC", all = TRUE)
agg$perc_cycles = agg$n_cycles/agg$tot_n_cycles*100
ggplot(agg, aes(x = tender_breasts_ul, y = perc_cycles, fill = BC)) +
geom_bar(stat = "identity") + scale_fill_manual(values = cols$BC3) + facet_grid(BC~.)
ggplot(agg[agg$BC != "unclear",], aes(x = tender_breasts_ul, y = perc_cycles, fill = BC)) +
geom_bar(stat = "identity") + scale_fill_manual(values = cols$BC3) + facet_grid(BC~.)
ggplot(agg[agg$BC != "unclear",], aes(x = tender_breasts_ul, y = perc_cycles, fill = BC)) +
geom_bar(stat = "identity") + scale_fill_manual(values = cols$BC3)
?geom_bar
ggplot(agg[agg$BC != "unclear",], aes(x = tender_breasts_ul, y = perc_cycles, fill = BC)) +
geom_bar(stat = "identity", position = "dodge") + scale_fill_manual(values = cols$BC3)
lim = 10
cycles$tender_breasts_ul = pmin(cycles$tender_breasts, 10)
cycles$tender_breasts_ul[cycles$tender_breasts_ul == lim] = paste0(lim, "+")
agg =  aggregate( cycle_id ~ tender_breasts_ul + BC, cycles, uniqueN)
agg$n_cycles = agg$cycle_id
agg_2 = aggregate(n_cycles ~ BC,agg, sum)
colnames(agg_2)[which(colnames(agg_2) == "n_cycles")] = "tot_n_cycles"
agg = merge(agg, agg_2,by = "BC", all = TRUE)
agg$perc_cycles = agg$n_cycles/agg$tot_n_cycles*100
ggplot(agg[agg$BC != "unclear",], aes(x = tender_breasts_ul, y = perc_cycles, fill = BC)) +
geom_bar(stat = "identity", position = "dodge") + scale_fill_manual(values = cols$BC3)
lim = 10
cycles$tender_breasts_ul = pmin(cycles$tender_breasts, 10)
cycles$tender_breasts_ul[cycles$tender_breasts_ul == lim] = paste0(lim, "+")
cycles$tender_breasts_ul = factor(cycles$tender_breasts_ul, levels = c(0:(lim-1),paste0(lim, "+")))
agg =  aggregate( cycle_id ~ tender_breasts_ul + BC, cycles, uniqueN)
agg$n_cycles = agg$cycle_id
agg_2 = aggregate(n_cycles ~ BC,agg, sum)
colnames(agg_2)[which(colnames(agg_2) == "n_cycles")] = "tot_n_cycles"
agg = merge(agg, agg_2,by = "BC", all = TRUE)
agg$perc_cycles = agg$n_cycles/agg$tot_n_cycles*100
ggplot(agg[agg$BC != "unclear",], aes(x = tender_breasts_ul, y = perc_cycles, fill = BC)) +
geom_bar(stat = "identity", position = "dodge") + scale_fill_manual(values = cols$BC3)
ggplot(agg[agg$BC != "unclear",], aes(x = tender_breasts_ul, y = perc_cycles, fill = BC)) +
geom_bar(stat = "identity", position = "dodge") +
scale_fill_manual(values = cols$BC3) + guides(fill = FALSE)+
xlab("# of reported Tender Breast symptoms per cycle")+ ylab("% of cycles")
save(agg, file = paste0(IO$out_Rdata, "n_TB_per_cycle.Rdata"))
save(agg, file = paste0(IO$out_Rdata, "n_TB_per_cycle.Rdata"))
g = ggplot(agg[agg$BC != "unclear",], aes(x = tender_breasts_ul, y = perc_cycles, fill = BC)) +
geom_bar(stat = "identity", position = "dodge") +
scale_fill_manual(values = cols$BC3) + guides(fill = FALSE)+
xlab("# of reported Tender Breast symptoms per cycle")+ ylab("% of cycles")
g
g = ggplot(agg[agg$BC != "unclear",], aes(x = tender_breasts_ul, y = perc_cycles, fill = BC)) +
geom_bar(stat = "identity", position = "dodge") +
scale_fill_manual(values = cols$BC3) + guides(fill = FALSE)+
xlab("# of reported Tender Breast symptoms per cycle")+ ylab("% of cycles")
g
ggsave(filename = paste0(IO$panels, "1_number_of_TB_per_cycle.pdf"), plot = g, width = viz$full_width/4, height = viz$full_width/4.5, scale = viz$scale)
lim = 3
users$frac_tender_breasts = pmin(round(users$n_tender_breasts/users$n_cycle, digits = 1),lim)
users$frac_tender_breasts = factor(users$frac_tender_breasts, levels = sort(unique(users$frac_tender_breasts)))
users$frac_tender_breasts[users$frac_tender_breasts == lim] = paste0(lim,"+")
lim = 3
users$frac_tender_breasts = pmin(round(users$n_tender_breasts/users$n_cycle, digits = 1),lim)
users$frac_tender_breasts = factor(users$frac_tender_breasts, levels = c(sort(unique(users$frac_tender_breasts)),paste0(lim,"+")))
users$frac_tender_breasts[users$frac_tender_breasts == lim] = paste0(lim,"+")
agg = aggregate( user_id ~ frac_tender_breasts, users, uniqueN)
agg$n_users = agg$user_id
agg$perc_users = agg$n_users/sum(agg$n_users)*100
ggplot(agg, aes(x = frac_tender_breasts, y = perc_users)) +
geom_bar(stat = "identity")
save(agg, file = paste0(IO$out_Rdata, "avg_symptoms_per_user.Rdata"))
load(file = paste0(IO$out_Rdata, "avg_symptoms_per_user.Rdata"), verbose = TRUE)
ggplot(agg, aes(x = frac_tender_breasts, y = perc_users)) +
geom_bar(stat = "identity")+
xlab("# of reported Tender Breast symptoms / # of cycles")+
ylab("% of users")
load(file = paste0(IO$out_Rdata, "avg_symptoms_per_user.Rdata"), verbose = TRUE)
g = ggplot(agg, aes(x = frac_tender_breasts, y = perc_users)) +
geom_bar(stat = "identity")+
xlab("# of reported Tender Breast symptoms / # of cycles")+
ylab("% of users")
g
ggsave(filename = paste0(IO$panels, "1_avg_TB_per_user.pdf"), plot = g, width = viz$full_width/4, height = viz$full_width/4.5, scale = viz$scale)
lim = 3
users$frac_tender_breasts = pmin(round(5*users$n_tender_breasts/users$n_cycle)/5,lim)
agg = aggregate( user_id ~ frac_tender_breasts + BC, users, uniqueN)
agg$n_users = agg$user_id
agg$perc_users = agg$n_users/sum(agg$n_users)*100
ggplot(agg, aes(x = frac_tender_breasts, y = perc_users, fill = BC)) +
geom_bar(stat = "identity", position = "dodge") + scale_fill_manual(values = cols$BC3)
ggplot(agg[agg$BC %in% c("pill","none / condoms")], aes(x = frac_tender_breasts, y = perc_users, fill = BC)) +
geom_bar(stat = "identity", position = "dodge") + scale_fill_manual(values = cols$BC)
ggplot(agg[agg$BC %in% c("pill","none / condoms"),], aes(x = frac_tender_breasts, y = perc_users, fill = BC)) +
geom_bar(stat = "identity", position = "dodge") + scale_fill_manual(values = cols$BC)
lim = 3
users$frac_tender_breasts = pmin(round(5*users$n_tender_breasts/users$n_cycle)/5,lim)
agg = aggregate( user_id ~ frac_tender_breasts + BC, users, uniqueN)
agg$n_users = agg$user_id
agg_2 = aggregate(n_users ~ BC,agg, sum)
colnames(agg_2)[which(colnames(agg_2) == "n_users")] = "tot_n_users"
agg = merge(agg, agg_2,by = "BC", all = TRUE)
agg$perc_users = agg$n_users/agg$tot_n_users*100
#agg$perc_users = agg$n_users/sum(agg$n_users)*100
save(agg, file = paste0(IO$out_Rdata, "avg_symptoms_per_user.Rdata"))
ggplot(agg[agg$BC %in% c("pill","none / condoms"),], aes(x = frac_tender_breasts, y = perc_users, fill = BC)) +
geom_bar(stat = "identity", position = "dodge") + scale_fill_manual(values = cols$BC)
agg
lim = 3
users$n_TB_by_n_cycles = pmin(round(5*users$n_tender_breasts/users$n_cycle)/5,lim)
agg = aggregate( user_id ~ n_TB_by_n_cycles + BC, users, uniqueN)
agg$n_users = agg$user_id
agg_2 = aggregate(n_users ~ BC,agg, sum)
colnames(agg_2)[which(colnames(agg_2) == "n_users")] = "tot_n_users"
agg = merge(agg, agg_2,by = "BC", all = TRUE)
agg$perc_users = agg$n_users/agg$tot_n_users*100
#agg$perc_users = agg$n_users/sum(agg$n_users)*100
agg = agg[,c("BC","n_TB_by_n_cycles","perc_users")]
save(agg, file = paste0(IO$out_Rdata, "avg_symptoms_per_user.Rdata"))
ggplot(agg[agg$BC %in% c("pill","none / condoms"),], aes(x = n_TB_by_n_cycles, y = perc_users, fill = BC)) +
geom_bar(stat = "identity", position = "dodge") + scale_fill_manual(values = cols$BC)
agg
load(file = paste0(IO$out_Rdata, "avg_symptoms_per_user.Rdata"), verbose = TRUE)
g = ggplot(agg, aes(x = n_TB_by_n_cycles, y = perc_users, fill = BC)) +
geom_bar(stat = "identity", position = "dodge" )+
scale_fill_manual(values = cols$BC)+
xlab("# of reported Tender Breast symptoms / # of cycles")+
ylab("% of users")
g
g = ggplot(agg[agg$BC %in% c("pill","none / condoms"),], aes(x = n_TB_by_n_cycles, y = perc_users, fill = BC)) +
geom_bar(stat = "identity", position = "dodge" )+
scale_fill_manual(values = cols$BC)+
xlab("# of reported Tender Breast symptoms / # of cycles")+
ylab("% of users")
g
load(file = paste0(IO$out_Rdata, "avg_symptoms_per_user.Rdata"), verbose = TRUE)
g = ggplot(agg[agg$BC %in% c("pill","none / condoms"),], aes(x = n_TB_by_n_cycles, y = perc_users, fill = BC)) +
geom_bar(stat = "identity", position = "dodge" )+
scale_fill_manual(values = cols$BC)+
xlab("# of reported Tender Breast symptoms / # of cycles")+
ylab("% of users")
g
ggsave(filename = paste0(IO$panels, "1_avg_TB_per_user.pdf"), plot = g, width = viz$full_width/4, height = viz$full_width/4.5, scale = viz$scale)
g = ggplot(agg[agg$BC %in% c("pill","none / condoms"),], aes(x = n_TB_by_n_cycles, y = perc_users, fill = BC)) +
geom_bar(stat = "identity", position = "dodge" )+
scale_fill_manual(values = cols$BC)+
xlab("# of reported Tender Breast symptoms / # of cycles")+
ylab("% of users") + guides(fill = FALSE)
g
ggsave(filename = paste0(IO$panels, "1_avg_TB_per_user.pdf"), plot = g, width = viz$full_width/4, height = viz$full_width/4.5, scale = viz$scale)
g = ggplot(agg[agg$BC %in% c("pill","none / condoms"),], aes(x = n_TB_by_n_cycles, y = perc_users, fill = BC)) +
geom_bar(stat = "identity", position = "dodge" )+
scale_fill_manual(values = cols$BC)+
xlab("# of reported TB symptoms / # of cycles")+
ylab("% of users") + guides(fill = FALSE)
g
ggsave(filename = paste0(IO$panels, "1_avg_TB_per_user.pdf"), plot = g, width = viz$full_width/4, height = viz$full_width/4.5, scale = viz$scale)
lim = 3
users$n_TB_by_n_cycles = pmin(round(4*users$n_tender_breasts/users$n_cycle)/4,lim)
agg = aggregate( user_id ~ n_TB_by_n_cycles + BC, users, uniqueN)
agg$n_users = agg$user_id
agg_2 = aggregate(n_users ~ BC,agg, sum)
colnames(agg_2)[which(colnames(agg_2) == "n_users")] = "tot_n_users"
agg = merge(agg, agg_2,by = "BC", all = TRUE)
agg$perc_users = agg$n_users/agg$tot_n_users*100
#agg$perc_users = agg$n_users/sum(agg$n_users)*100
agg = agg[,c("BC","n_TB_by_n_cycles","perc_users")]
save(agg, file = paste0(IO$out_Rdata, "avg_symptoms_per_user.Rdata"))
load(file = paste0(IO$out_Rdata, "avg_symptoms_per_user.Rdata"), verbose = TRUE)
g = ggplot(agg[agg$BC %in% c("pill","none / condoms"),], aes(x = n_TB_by_n_cycles, y = perc_users, fill = BC)) +
geom_bar(stat = "identity", position = "dodge" )+
scale_fill_manual(values = cols$BC)+
xlab("# of reported TB symptoms / # of cycles")+
ylab("% of users") + guides(fill = FALSE)
g
ggsave(filename = paste0(IO$panels, "1_avg_TB_per_user.pdf"), plot = g, width = viz$full_width/4, height = viz$full_width/4.5, scale = viz$scale)
ggsave(filename = paste0(IO$panels, "1_avg_TB_per_user.pdf"), plot = g, width = viz$full_width/4.5, height = viz$full_width/4.5, scale = viz$scale)
lim = 3
users$n_TB_by_n_cycles = pmin(round(3*users$n_tender_breasts/users$n_cycle)/3,lim)
agg = aggregate( user_id ~ n_TB_by_n_cycles + BC, users, uniqueN)
agg$n_users = agg$user_id
agg_2 = aggregate(n_users ~ BC,agg, sum)
colnames(agg_2)[which(colnames(agg_2) == "n_users")] = "tot_n_users"
agg = merge(agg, agg_2,by = "BC", all = TRUE)
agg$perc_users = agg$n_users/agg$tot_n_users*100
#agg$perc_users = agg$n_users/sum(agg$n_users)*100
agg = agg[,c("BC","n_TB_by_n_cycles","perc_users")]
save(agg, file = paste0(IO$out_Rdata, "avg_symptoms_per_user.Rdata"))
load(file = paste0(IO$out_Rdata, "avg_symptoms_per_user.Rdata"), verbose = TRUE)
g = ggplot(agg[agg$BC %in% c("pill","none / condoms"),], aes(x = n_TB_by_n_cycles, y = perc_users, fill = BC)) +
geom_bar(stat = "identity", position = "dodge" )+
scale_fill_manual(values = cols$BC)+
xlab("# of reported TB symptoms / # of cycles")+
ylab("% of users") + guides(fill = FALSE)
g
ggsave(filename = paste0(IO$panels, "1_avg_TB_per_user.pdf"), plot = g, width = viz$full_width/4.5, height = viz$full_width/4.5, scale = viz$scale)
lim = 3
users$n_TB_by_n_cycles = pmin(round(4*users$n_tender_breasts/users$n_cycle)/4,lim)
agg = aggregate( user_id ~ n_TB_by_n_cycles + BC, users, uniqueN)
agg$n_users = agg$user_id
agg_2 = aggregate(n_users ~ BC,agg, sum)
colnames(agg_2)[which(colnames(agg_2) == "n_users")] = "tot_n_users"
agg = merge(agg, agg_2,by = "BC", all = TRUE)
agg$perc_users = agg$n_users/agg$tot_n_users*100
#agg$perc_users = agg$n_users/sum(agg$n_users)*100
agg = agg[,c("BC","n_TB_by_n_cycles","perc_users")]
save(agg, file = paste0(IO$out_Rdata, "avg_symptoms_per_user.Rdata"))
load(file = paste0(IO$out_Rdata, "avg_symptoms_per_user.Rdata"), verbose = TRUE)
g = ggplot(agg[agg$BC %in% c("pill","none / condoms"),], aes(x = n_TB_by_n_cycles, y = perc_users, fill = BC)) +
geom_bar(stat = "identity", position = "dodge" )+
scale_fill_manual(values = cols$BC)+
xlab("# of reported TB symptoms / # of cycles")+
ylab("% of users") + guides(fill = FALSE)
g
lim = 3
users$n_TB_by_n_cycles = pmin(round(3*users$n_tender_breasts/users$n_cycle)/3,lim)
agg = aggregate( user_id ~ n_TB_by_n_cycles + BC, users, uniqueN)
agg$n_users = agg$user_id
agg_2 = aggregate(n_users ~ BC,agg, sum)
colnames(agg_2)[which(colnames(agg_2) == "n_users")] = "tot_n_users"
agg = merge(agg, agg_2,by = "BC", all = TRUE)
agg$perc_users = agg$n_users/agg$tot_n_users*100
#agg$perc_users = agg$n_users/sum(agg$n_users)*100
agg = agg[,c("BC","n_TB_by_n_cycles","perc_users")]
save(agg, file = paste0(IO$out_Rdata, "avg_symptoms_per_user.Rdata"))
load(file = paste0(IO$out_Rdata, "avg_symptoms_per_user.Rdata"), verbose = TRUE)
g = ggplot(agg[agg$BC %in% c("pill","none / condoms"),], aes(x = n_TB_by_n_cycles, y = perc_users, fill = BC)) +
geom_bar(stat = "identity", position = "dodge" )+
scale_fill_manual(values = cols$BC)+
xlab("# of reported TB symptoms / # of cycles")+
ylab("% of users") + guides(fill = FALSE)
g
ggsave(filename = paste0(IO$panels, "1_avg_TB_per_user.pdf"), plot = g, width = viz$full_width/4.5, height = viz$full_width/4.5, scale = viz$scale)
load(file = paste0(IO$r_output_data,"sub_days_examples_input_data.Rdata"), verbose = TRUE)
days = sub_days
user_ids = unique(days$user_id)
for(user_id in user_ids){
j = which((days$user_id == user_id)&(!is.na(days$cycle_id_m)) & (days$category != "pill_hbc") & (days$cycle_nb_m %in% 4:8))
d = days[j,]
g = ggplot_user_example(d = d, title = FALSE, size_factor = 1.5)
print(g)
ggsave(filename = paste0(IO$panels, "1A_example_",d$user_id[1],".pdf"), plot = g, width = viz$full_width/2.8, height = viz$full_width/4)
}
